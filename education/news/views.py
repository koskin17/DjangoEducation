from django.shortcuts import render, get_object_or_404, redirect
from django.views.generic import ListView

from .models import News, Category
from .forms import NewsForm


class HomeNews(ListView):   # –í —ç—Ç–æ–º –∫–ª–∞—Å—Å–µ –º—ã –±—É–¥–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤
    model = News    # –ó–¥–µ—Å—å –æ–ø—Ä–µ–¥–µ–ª—è–ª–µ—Ç—Å—è –º–æ–¥–µ–ª—å, —Å –∫–æ—Ç–æ—Ä–æ–π –º—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å. –ü–æ —Å—É—Ç–∏ —ç—Ç–æ –∑–∞–º–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∏ news = News.objects.all()
    # –ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–≤–æ–∏–º —à–∞–±–ª–æ–Ω–æ–º, –∞ –Ω–µ —Å —à–∞–±–ª–æ–Ω–æ–º news_list, –∫–æ—Ç–æ—Ä—ã–π –∏—â–µ—Ç django –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∏ –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ —Å –æ–±—ä–µ–∫—Ç–æ–º ObjectList, –∞ —Ö–æ—Ç–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–±—ä–µ–∫—Ç–æ–º News, —Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –¥—Ä—É–≥–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∫–ª–∞—Å—Å–∞
    template_name = 'news/home_news_list.html'  # –¢–∞–∫ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ –∏–º—è —à–∞–±–ª–æ–Ω–∞, —Å –∫–æ—Ç–æ—Ä—ã–º –º—ã —Ö–æ—Ç–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å
    context_object_name = 'news' # –¢–∞–∫ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –æ–±—ä–µ–∫—Ç, –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã —Ö–æ—Ç–∏–º –ø–æ–ª—É—á–∞—Ç—å
    # extra_context = {'title': '–ì–ª–∞–≤–Ω–∞—è'}    # –≠—Ç–æ –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –∫–æ—Ç–æ—Ä–∞—è —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ï–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –î–ª—è —Å–ø–∏—Å–∫–æ–≤, –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å get_context_data, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å–∞–Ω –Ω–∏–∂–µ.

    def get_context_data(self, **kwargs):   # –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö
        context = super().get_context_data(**kwargs)  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω—É—é context –∏ –±–µ—Ä—ë–º –∏–∑ –Ω–µ—ë —Ç–æ, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –º–µ—Ç–æ–¥. –¢–∞–∫ –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ –±—ã–ª–∏
        context['title'] = '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞'
        # –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –º—ã –≤–∑—è–ª–∏ –≤—Å—ë, —á—Ç–æ–±—ã –±—ã–ª–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏ –¥–æ–ø–æ–ª–Ω–∏–ª–∏ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —Ç.–µ. –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ —à–∞–±–ª–æ–Ω 
        return context
    
    def get_queryset(self): #–¢—É—Ç –º—ã –ø–æ–ø—Ä–∞–≤–ª—è–µ–º –¥–µ–≤–æ–ª—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Å—ë, –Ω–∞ –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ –ø—Ä–∏–∑–Ω–∞–∫—É. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –Ω–æ–≤–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã.
        return News.objects.filter(is_published = True)
    
class NewsByCategory(ListView):
    model = News
    template_name = 'news/home_news+list.html'  #–¢–∞–∫–∂–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞–±–ª–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    context_object_name = 'news'
    allow_empty = False # –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç –∫–ª–∞—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–µ —Å–ø–∏—Å–∫–∏. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ True. –ü–æ—Å—Ç–∞–≤–∏–≤ –≤ False –∑–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –ø–æ–∫–∞–∑ –ø—É—Å—Ç—ã—Ö —Å–ø–∏—Å–∫–æ–≤, —Ç.–µ. –µ—Å–ª–∏, –∫ –ø—Ä–∏–º–µ—Ä—É, –∫–∞—Ç–µ–≥–æ—Ä–∏—è –ø—É—Å—Ç–∞—è, —Ç.–µ. –≤ –Ω–µ–π –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π, —Ç–æ —Å–∞–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è, –∞ –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ –æ—à–∏–±–∫–∞ 404, —Ç.–µ. –Ω–µ—Ç —Ç–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –ø—É—Å—Ç–∞—è, —Ç.–µ. –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞–∫-–±—ã –Ω–µ—Ç.

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['title'] = Category.objects.get(pk=self.kwargs['category_id'])
        return context

    def get_queryset(self): # –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä category_id, –∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç—å –≤ –æ–±—ä–µ–∫—Ç–µ self. –¢.–µ. –º—ã –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ —Ñ–∏–ª—å—Ç—Ä—É –µ—â—ë –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ category_id
        return News.objects.filter(category_id = self.kwargs['category_id'], is_published = True)
        ## üîç –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `self.kwargs['category_id']`?
        # –ö–æ–≥–¥–∞ —Ç—ã –æ–ø–∏—Å–∞–ª –º–∞—Ä—à—Ä—É—Ç:
        # ```python
        # path('category/<int:category_id>/', NewsByCategory.as_view(), name='category'),
        # Django —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç URL —Å **–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º** `category_id`.
        # üîß –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/category/3/`:
        # - Django –∏–∑–≤–ª–µ–∫–∞–µ—Ç `category_id=3` –∏–∑ URL
        # - –ò –ø–µ—Ä–µ–¥–∞—ë—Ç –µ–≥–æ –≤ –∫–ª–∞—Å—Å `NewsByCategory`
        # - –í–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –µ–≥–æ —á–µ—Ä–µ–∑:
        # ```python
        # self.kwargs['category_id']
        # ```

        # üì¶ `kwargs` ‚Äî —ç—Ç–æ —Å–ª–æ–≤–∞—Ä—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL.  
        # –ï—Å–ª–∏ –±—ã —Ç—ã –æ–ø–∏—Å–∞–ª `path('category/<int:id>/', ...)`, —Ç–æ –±—ã–ª –±—ã `self.kwargs['id']`.
        # ---
        # ## üß† –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è —ç—Ç–∏ `kwargs`?
        # –û–Ω–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ Django'–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ `urls.py`.  
        # –ö–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å `<int:category_id>`, —Ç—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—à—å `category_id`, –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–∞–∫ `kwargs['category_id']`.

# –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ ListView —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ —Å—Ç–∞–ª –Ω–µ –Ω—É–∂–µ–Ω –∏ —è –µ–≥–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ —É–¥–∞–ª–∏–ª.
# def index(request):
#     news = News.objects.all()  # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –Ω–æ–≤–æ—Å—Ç–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. –°–æ—Ç—Ä–∏—Ä–æ–≤–∫–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –º–æ–¥–µ–ª–∏, –∏–∑ –∫–ª–∞—Å—Å–∞ Meta
#     context = {
#         'news': news,
#         'title': '–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π',
#     }
#     return render(request, template_name='news/index.html', context=context)
#     # –í —Ñ—É–Ω–∫—Ü–∏—é render –º—ã –ø–µ—Ä–µ–¥–∞—ë–º —Å–∞–º –∑–∞–ø—Ä–æ—Å, –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —à–∞–±–ª–æ–Ω–∞, –∞ —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–≤ html-—à–∞–±–ª–æ–Ω–µ) –ø–æ —Å–≤–æ–∏–º –∏–º–µ–Ω–∞–º

def get_category(request, category_id):
    news = News.objects.filter(category_id=category_id)
    category = Category.objects.get(pk=category_id)
    return render(request, 'news/category.html', { 'news': news, 'category': category})

def view_news(request, news_id):
    # news_item = News.objects.get(pk=news_id)
    news_item = get_object_or_404(News, pk=news_id)
    return render(request, 'news/view_news.html', {"news_item": news_item})

def add_news(request):
    if request.method == 'POST':
        form = NewsForm(request.POST) # –¢–∞–∫ –º—ã –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —Ñ–æ—Ä–º–µ –∏ –∑–∞–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª–∞ –º–µ—Ç–æ–¥–æ–º POST
        # –ú–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –ø—Ä–æ—à–ª–∞ –ª–∏ —Ñ–æ—Ä–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é
        if form.is_valid():   # –ï—Å—Ç—å –º–µ—Ç–æ–¥ is_bond, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –±—ã–ª–∏ –ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏–ª—Å—è –ª–∏ –æ–±—ä–µ–∫—Ç –∏–∑ forms—ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            # print(form.cleaned_data)    # –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é, —Ç–æ —É –Ω–µ—ë –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–æ cleaned_data - —ç—Ç–æ —Å–ª–æ–≤–∞—Ä—å, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–æ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
            # news = News.objects.create(**form.cleaned_data) # –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ ** - —ç—Ç–æ –º–µ—Ç–æ–¥ python –¥–ª—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∏ —Å–ª–æ–≤–∞—Ä–µ–π. –¢.–µ. title, content –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–ª—é—á–∞–º. –≠—Ç–æ –∏ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏. –ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ create –ø–æ—Ç–æ–º—É —á—Ç–æ –º–µ—Ç–æ–¥–∞ save() –Ω–µ—Ç —É —Ñ–æ—Ä–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å –º–æ–¥–µ–ª—è–º–∏.
            # # –î–ª—è —Ñ–æ—Ä–º, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –º–æ–¥–µ–ª—è–º–∏, –µ—Å—Ç—å –º–µ—Ç–æ–¥ save(). –ü—Ä–∏ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –Ω–µ –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (form.cleaned_data)
            news = form.save()
            return redirect(news)
    else:
        # –ï—Å–ª–∏ –∂–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–µ POST, –∞ GET, —Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –ø—É—Å—Ç–∞—è —Ñ–æ—Ä–º–∞
        form = NewsForm()
    return render(request, 'news/add_news.html', {'form': form})
